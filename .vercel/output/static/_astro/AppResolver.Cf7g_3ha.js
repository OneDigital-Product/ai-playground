import{u as P,j as s,w as I,a as C,b as z,c as M}from"./ErrorBoundary.CguKR82e.js";import{a as L}from"./api.CYROLObq.js";import{r as T}from"./index.DtoOFyvK.js";function R({children:t,title:r}){const{isAuthenticated:e,isLoading:n}=P();return n?s.jsx("p",{children:"Loading…"}):e?s.jsxs("section",{style:{padding:"1rem",border:"1px solid #eee",borderRadius:8},children:[r?s.jsx("h3",{style:{marginTop:0,marginBottom:12,fontSize:18,fontWeight:700},children:r}):null,t]}):s.jsx("p",{children:"Please sign in to use this app."})}const $={withStackTrace:!1},U=(t,r,e=$)=>{const n=r.isOk()?{type:"Ok",value:r.value}:{type:"Err",value:r.error},i=e.withStackTrace?new Error().stack:void 0;return{data:n,message:t,stack:i}};function E(t,r,e,n){function i(o){return o instanceof e?o:new e(function(a){a(o)})}return new(e||(e=Promise))(function(o,a){function l(f){try{c(n.next(f))}catch(v){a(v)}}function d(f){try{c(n.throw(f))}catch(v){a(v)}}function c(f){f.done?o(f.value):i(f.value).then(l,d)}c((n=n.apply(t,[])).next())})}function k(t){var r=typeof Symbol=="function"&&Symbol.iterator,e=r&&t[r],n=0;if(e)return e.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(r?"Object is not iterable.":"Symbol.iterator is not defined.")}function w(t){return this instanceof w?(this.v=t,this):new w(t)}function O(t,r,e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=e.apply(t,r||[]),i,o=[];return i=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),l("next"),l("throw"),l("return",a),i[Symbol.asyncIterator]=function(){return this},i;function a(u){return function(g){return Promise.resolve(g).then(u,v)}}function l(u,g){n[u]&&(i[u]=function(S){return new Promise(function(D,N){o.push([u,S,D,N])>1||d(u,S)})},g&&(i[u]=g(i[u])))}function d(u,g){try{c(n[u](g))}catch(S){x(o[0][3],S)}}function c(u){u.value instanceof w?Promise.resolve(u.value.v).then(f,v):x(o[0][2],u)}function f(u){d("next",u)}function v(u){d("throw",u)}function x(u,g){u(g),o.shift(),o.length&&d(o[0][0],o[0][1])}}function V(t){var r,e;return r={},n("next"),n("throw",function(i){throw i}),n("return"),r[Symbol.iterator]=function(){return this},r;function n(i,o){r[i]=t[i]?function(a){return(e=!e)?{value:w(t[i](a)),done:!1}:o?o(a):a}:o}}function q(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=t[Symbol.asyncIterator],e;return r?r.call(t):(t=typeof k=="function"?k(t):t[Symbol.iterator](),e={},n("next"),n("throw"),n("return"),e[Symbol.asyncIterator]=function(){return this},e);function n(o){e[o]=t[o]&&function(a){return new Promise(function(l,d){a=t[o](a),i(l,d,a.done,a.value)})}}function i(o,a,l,d){Promise.resolve(d).then(function(c){o({value:c,done:l})},a)}}class h{constructor(r){this._promise=r}static fromSafePromise(r){const e=r.then(n=>new m(n));return new h(e)}static fromPromise(r,e){const n=r.then(i=>new m(i)).catch(i=>new p(e(i)));return new h(n)}static fromThrowable(r,e){return(...n)=>new h(E(this,void 0,void 0,function*(){try{return new m(yield r(...n))}catch(i){return new p(e?e(i):i)}}))}static combine(r){return G(r)}static combineWithAllErrors(r){return Q(r)}map(r){return new h(this._promise.then(e=>E(this,void 0,void 0,function*(){return e.isErr()?new p(e.error):new m(yield r(e.value))})))}andThrough(r){return new h(this._promise.then(e=>E(this,void 0,void 0,function*(){if(e.isErr())return new p(e.error);const n=yield r(e.value);return n.isErr()?new p(n.error):new m(e.value)})))}andTee(r){return new h(this._promise.then(e=>E(this,void 0,void 0,function*(){if(e.isErr())return new p(e.error);try{yield r(e.value)}catch{}return new m(e.value)})))}orTee(r){return new h(this._promise.then(e=>E(this,void 0,void 0,function*(){if(e.isOk())return new m(e.value);try{yield r(e.error)}catch{}return new p(e.error)})))}mapErr(r){return new h(this._promise.then(e=>E(this,void 0,void 0,function*(){return e.isOk()?new m(e.value):new p(yield r(e.error))})))}andThen(r){return new h(this._promise.then(e=>{if(e.isErr())return new p(e.error);const n=r(e.value);return n instanceof h?n._promise:n}))}orElse(r){return new h(this._promise.then(e=>E(this,void 0,void 0,function*(){return e.isErr()?r(e.error):new m(e.value)})))}match(r,e){return this._promise.then(n=>n.match(r,e))}unwrapOr(r){return this._promise.then(e=>e.unwrapOr(r))}safeUnwrap(){return O(this,arguments,function*(){return yield w(yield w(yield*V(q(yield w(this._promise.then(e=>e.safeUnwrap()))))))})}then(r,e){return this._promise.then(r,e)}[Symbol.asyncIterator](){return O(this,arguments,function*(){const e=yield w(this._promise);return e.isErr()&&(yield yield w(_(e.error))),yield w(e.value)})}}function _(t){return new h(Promise.resolve(new p(t)))}const W=t=>{let r=b([]);for(const e of t)if(e.isErr()){r=y(e.error);break}else r.map(n=>n.push(e.value));return r},G=t=>h.fromSafePromise(Promise.all(t)).andThen(W),B=t=>{let r=b([]);for(const e of t)e.isErr()&&r.isErr()?r.error.push(e.error):e.isErr()&&r.isOk()?r=y([e.error]):e.isOk()&&r.isOk()&&r.value.push(e.value);return r},Q=t=>h.fromSafePromise(Promise.all(t)).andThen(B);var j;(function(t){function r(i,o){return(...a)=>{try{const l=i(...a);return b(l)}catch(l){return y(o?o(l):l)}}}t.fromThrowable=r;function e(i){return W(i)}t.combine=e;function n(i){return B(i)}t.combineWithAllErrors=n})(j||(j={}));function b(t){return new m(t)}function y(t){return new p(t)}class m{constructor(r){this.value=r}isOk(){return!0}isErr(){return!this.isOk()}map(r){return b(r(this.value))}mapErr(r){return b(this.value)}andThen(r){return r(this.value)}andThrough(r){return r(this.value).map(e=>this.value)}andTee(r){try{r(this.value)}catch{}return b(this.value)}orTee(r){return b(this.value)}orElse(r){return b(this.value)}asyncAndThen(r){return r(this.value)}asyncAndThrough(r){return r(this.value).map(()=>this.value)}asyncMap(r){return h.fromSafePromise(r(this.value))}unwrapOr(r){return this.value}match(r,e){return r(this.value)}safeUnwrap(){const r=this.value;return function*(){return r}()}_unsafeUnwrap(r){return this.value}_unsafeUnwrapErr(r){throw U("Called `_unsafeUnwrapErr` on an Ok",this,r)}*[Symbol.iterator](){return this.value}}class p{constructor(r){this.error=r}isOk(){return!1}isErr(){return!this.isOk()}map(r){return y(this.error)}mapErr(r){return y(r(this.error))}andThrough(r){return y(this.error)}andTee(r){return y(this.error)}orTee(r){try{r(this.error)}catch{}return y(this.error)}andThen(r){return y(this.error)}orElse(r){return r(this.error)}asyncAndThen(r){return _(this.error)}asyncAndThrough(r){return _(this.error)}asyncMap(r){return _(this.error)}unwrapOr(r){return r}match(r,e){return e(this.error)}safeUnwrap(){const r=this.error;return function*(){throw yield y(r),new Error("Do not use this generator out of `safeTry`")}()}_unsafeUnwrap(r){throw U("Called `_unsafeUnwrap` on an Err",this,r)}_unsafeUnwrapErr(r){return this.error}*[Symbol.iterator](){const r=this;return yield r,r}}j.fromThrowable;const A=L;function H(){const t=C(A.messages?.list,{}),r=z(A.messages?.send),[e,n]=T.useState(""),[i,o]=T.useState(null),[a,l]=T.useState(!1),d=async c=>{c.preventDefault(),o(null);const f=e.trim();if(!f)return;l(!0);const v=await h.fromPromise(r({content:f}),x=>x instanceof Error?x:new Error(String(x)));if(l(!1),v.isErr()){o(v.error.message);return}n("")};return s.jsxs(R,{title:"Chat App",children:[s.jsxs("form",{onSubmit:d,style:{display:"flex",gap:8},children:[s.jsx("input",{value:e,onChange:c=>n(c.target.value),placeholder:"Say something…",style:{flex:1,padding:"0.5rem",border:"1px solid #ddd",borderRadius:6}}),s.jsx("button",{disabled:a||!e.trim(),type:"submit",children:a?"Sending…":"Send"})]}),i?s.jsxs("p",{style:{color:"#b91c1c",marginTop:8},children:["Error: ",i]}):null,s.jsx("ul",{style:{listStyle:"none",padding:0,marginTop:12,display:"grid",gap:8},children:t===void 0?s.jsx("li",{children:"Loading messages…"}):t.length===0?s.jsx("li",{children:"No messages yet. Say hello!"}):t.map(c=>s.jsxs("li",{style:{padding:8,border:"1px solid #eee",borderRadius:6},children:[s.jsxs("div",{style:{fontSize:12,color:"#6b7280"},children:[c.displayName||c.userId," —"," ",new Date(c.createdAt).toLocaleString()]}),s.jsx("div",{children:c.content})]},c._id))})]})}const J=I(H,{boundaryId:"ChatApp"}),K={chat:J};function X(t){return K[t]||null}const Y=L;function Z({slug:t}){const{isAuthenticated:r,isLoading:e}=P(),n=C(Y.apps?.getApp,r?{slug:t}:"skip");if(e)return s.jsx("p",{children:"Loading…"});if(!r)return s.jsx("p",{children:"Please sign in to access apps."});if(n===void 0)return s.jsx("p",{children:"Loading app…"});if(n===null)return s.jsx("p",{children:"App not found."});const i=X(n.slug);return s.jsxs("div",{style:{padding:"1rem"},children:[s.jsx("h2",{style:{fontSize:20,fontWeight:700},children:n.name}),s.jsxs("p",{style:{color:"#6b7280"},children:["Slug: ",n.slug]}),s.jsx("div",{style:{marginTop:12},children:i?s.jsx(i,{}):s.jsx("div",{style:{padding:12,border:"1px dashed #ddd",borderRadius:8},children:s.jsx("p",{children:"No island registered for this app."})})})]})}const tr=M(I(Z,{boundaryId:"AppResolver"}));export{tr as default};
